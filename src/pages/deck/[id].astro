---
import MainLayout from "../../layouts/MainLayout.astro";
import { FlashcardsList } from "../../components/FlashcardsList";

export const prerender = false;

const { id } = Astro.params;

// Fetch deck name for the title
let deckName = "";
try {
  const supabase = Astro.locals.supabase;
  if (supabase && id) {
    const {
      data: { user },
      error: userError,
    } = await supabase.auth.getUser();

    if (!userError && user) {
      const { data: deck, error: deckError } = await supabase
        .from("flashcards_deck_names")
        .select("deck_name")
        .eq("id", parseInt(id, 10))
        .eq("user_id", user.id)
        .single();

      if (!deckError && deck) {
        deckName = deck.deck_name;
      }
    }
  }
} catch {
  // Error handling - deck name will remain empty string
}
---

<MainLayout title={deckName ? `Fiszki talii: ${deckName}` : "Fiszki talii"}>
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col gap-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold tracking-tight">
            {
              deckName ? (
                <>
                  Fiszki talii: <span class="text-[#d1b6dd] dark:text-purple-400">{deckName}</span>
                </>
              ) : (
                "Fiszki talii"
              )
            }
          </h1>
          <p class="text-muted-foreground">Przeglądaj i edytuj fiszki w tej talii</p>
        </div>
        <div class="flex gap-2">
          <a
            href="/flashcards"
            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] border bg-background shadow-xs hover:bg-background/60 dark:bg-input/30 dark:border-input h-10 px-4 py-2"
          >
            ← Powrót do talii
          </a>
        </div>
      </div>
      <FlashcardsList client:only="react" deckId={id} />
    </div>
  </div>
</MainLayout>
